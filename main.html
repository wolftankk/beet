<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Beet主控制区</title>
		<meta name="description" content="" >
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

		<link rel="stylesheet" type="text/css" href="resources/css/ext-all.css" />
		<link rel="stylesheet" type="text/css" href="resources/css/beet.css" />

		<script type="text/javascript" src="js/bootstrap.js"></script>
		<script type="text/javascript" src="js/ext-lang-zh_CN.js"></script>
		<script type="text/javascript" src="js/beet.js"></script>

		<!-- let the stupid ie suport html5 -->
		<!--[if lt IE 9]>
		<script src="js/html5.js"></script>
		<![endif]-->

		<!-- load yahoo and my js -->
		<script type="text/javascript" src="js/my/yahoo-min.js"></script>
		<script type="text/javascript" src="js/my/json-min.js"></script>
		<script type="text/javascript" src="js/my/event-min.js"></script>
		<script type="text/javascript" src="js/my/connection-min.js"></script>
		<script type="text/javascript" src="js/my/utf.js"></script>
		<script type="text/javascript" src="js/my/MyCallRecord_intf.js"></script>
		<script type="text/javascript" src="js/my/xxtea.js"></script>
	</head>
	<body>
		<header>
			<!-- 导航层 -->
			<nav id="navigation"></nav>
		</header>
		<section id="viewport">
		</section>
		<footer>
			<script type="text/javascript">
				var dataview, userId;
				var mls = new MyCRLoginSvc("http://192.168.1.100:6661/MULTI");
				var mps = new MyCallRecordSvc("http://192.168.1.100:6661/MULTI");
				Ext.onReady(function(){
					Ext.QuickTips.init();
					Ext.create("Beet.apps.Menu")

					dataview = Ext.create("Beet.apps.Grid.DataView", {
						store : 'Beet.apps.Grid.Store.CRecord'
					})

					function Button1_onclick() {
						mls.Login("admin", xxtea_encrypt('admin'), '', '' ,{
							success: function(res) { 
								userId = res;
							},
							failure: function(error) {
								console.log(error);
							}
						})
					}

					if (!userId){
						Ext.defer(Button1_onclick, 250)
					}

					Ext.defer(function(){
						//console.log(userId);
						mls.GetSessionID({
							success: function(res){
								dataview.storeProxy.on("beforeload", function(store){
									console.log("Fire beforeload");
									store.proxy.extraParams = {SessionID : res, Where: '', isClean: false}	
									console.log(store);
								})
								dataview.storeProxy.load({params: { start: 0, limit: 50 }});
							},
							failure: function(error){
								console.log(error);
							}
						})
					}, 2000)
				});
	
			</script>
		</footer>	
	</body>
</html>
